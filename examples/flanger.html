<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, minimal-ui">
    <title>Sono</title>
    <link href="css/styles.css" rel="stylesheet">
</head>
<body>
    <h1>Flanger</h1>

    <h3>Flanging webaudio</h3>
    <div class="js-playerA"></div>

    <div style="padding: 4px;"></div>

    <form class="Player-slider" oninput="output.value=range.value">
        <h4>Delay <output name="output" for="range"></output></h4>
        <span>0.005</span><input class="Player-slider-input js-delay" name="range" type="range" min="0.005" max="0.025" step="0.001" value="0.005" /><span>0.025</span>
    </form>

    <form class="Player-slider" oninput="output.value=range.value">
        <h4>LFO gain <output name="output" for="range"></output></h4>
        <span>0.0005</span><input class="Player-slider-input js-lfo-gain" name="range" type="range" min="0.0005" max="0.005" step="0.00025" value="0.002" /><span>0.005</span>
    </form>

    <form class="Player-slider" oninput="output.value=range.value">
        <h4>LFO frequency <output name="output" for="range"></output></h4>
        <span>0.05</span><input class="Player-slider-input js-lfo-freq" name="range" type="range" min="0.05" max="5" step="0.05" value="0.25" /><span>5</span>
    </form>

    <form class="Player-slider" oninput="output.value=range.value/100">
        <h4>Feedback <output name="output" for="range"></output></h4>
        <span>0</span><input class="Player-slider-input js-feedback" name="range" type="range" min="0" max="90" value="50" /><span>0.9</span>
    </form>

    <h3>Flanging pre-recorded</h3>
    <div class="js-playerB"></div>

    <script>
        // Test with no WebAudio
        //window.AudioContext = window.webkitAudioContext = undefined;
    </script>
    <script src="../dist/sono.js"></script>
    <script src="js/player.js"></script>
    <script>
        (function() {
            'use strict';

            Sono.log();

            var original,
                flanger;

            var delay = document.querySelector('.js-delay');
            delay.addEventListener('change', function() {
                flanger.delay = this.value;
            });
            
            var lfoGain = document.querySelector('.js-lfo-gain');
            lfoGain.addEventListener('change', function() {
                flanger.lfoGain = this.value;
            });

            var lfoFreq = document.querySelector('.js-lfo-freq');
            lfoFreq.addEventListener('change', function() {
                flanger.lfoFrequency = this.value;
            });

            var feedback = document.querySelector('.js-feedback');
            feedback.addEventListener('change', function() {
                flanger.feedback = this.value / 100;
            });

            Sono.load({
                url: [
                    {
                        id: 'original',
                        url: ['audio/Original.ogg', 'audio/Original.mp3']
                    },
                    {
                        id: 'phasing',
                        url: ['audio/Flanging.ogg', 'audio/Flanging.mp3']
                        //url: ['audio/Phasing.ogg', 'audio/Phasing.mp3']
                    }
                ],
                onComplete: function(sounds) {

                    original = Sono.getSound('original');
                    flanger = original.node.flanger(false);

                    new Player(original, document.querySelector('.js-playerA'));
                    new Player(Sono.getSound('phasing'), document.querySelector('.js-playerB'));
                }

            });

        }());
    </script>
</body>
</html>
