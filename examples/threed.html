<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, minimal-ui">
    <title></title>
    <link href="css/styles.css" rel="stylesheet">
</head>
<body>
    <script src="../dist/sono.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/three.js/r68/three.min.js"></script>
    <script src="js/threed.js"></script>
    <script>
        (function() {
            'use strict';

            document.addEventListener('DOMContentLoaded', function() {
                
                var scene = new ThreeScene();

                var sound = Sono.createSound(['audio/DRUMS.ogg', 'audio/DRUMS.mp3']);
                sound.loop = true;
                // add a panner node
                var pan = sound.node.panner();

                pan.node.distanceModel = 'linear'; // 'linear' 'inverse' 'exponential'
                pan.node.refDistance = 1;
                pan.node.maxDistance = 1000;
                pan.node.rolloffFactor = 1;

                /*panner.coneOuterGain = 0.5;
                panner.coneOuterAngle = 180;
                panner.coneInnerAngle = 0;*/
                
                // set source position to the position vector of the speaker
                pan.setSourcePosition(scene.speaker.position);
                
                // set source orientation to the normalised position vector of the speaker
                var orientation = scene.speaker.position.clone().normalize();
                pan.setSourceOrientation(orientation);
                
                // play
                sound.play();

                function update() {
                    window.requestAnimationFrame(update);
                    scene.render();

                    // set listener orientation to the forward vector of the hero
                    pan.setListenerOrientation(scene.hero.forward);

                    // set listener position to the position vector of the hero
                    pan.setListenerPosition(scene.hero.position);
                }
                update();

            });
            

        }());
    </script>
    <h1>3D panning</h1>
    <p>Use the arrow keys to move around the room. Space to jump.</p>
</body>
</html>
