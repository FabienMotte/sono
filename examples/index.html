<!DOCTYPE html>
<!--[if lt IE 9]><html lang="en" class="no-js old-ie"><![endif]-->
<!--[if gt IE 9]><!--><html lang="en" class="no-js"><!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, minimal-ui">

	<meta name="description" content="">
    <meta name="idwords" content="">

    <meta property="og:title" content="">
    <meta property="og:site_name" content="">
    <meta property="og:description" content="">
    <meta property="og:type" content="website">
    <meta property="og:url" content="">
    <meta property="og:image" content="">
    <link rel="image_src" href="">
    <link rel="shortcut icon" href="favicon.ico">

	<title></title>
	<link href="css/styles.css" rel="stylesheet">
	<script src="js/modernizr/modernizr.js"></script>
</head>
<body>
	<h1>sono</h1>

    <ul>
        <li>Simple example</li>
        <li>WebAudio</li>
        <li>Audio el v Array Buffer</li>
        <li>Video el</li>
        <li>Crazy ones like video texture in THREE.js (a TV?)</li>
        <li>Game e.g. different environments/rooms?</li>
    </ul>

    <h3>Player A</h3>

    <div class="Player js-playerA">
        <div class="Player-waveform">
            <canvas class="Player-waveform-inner js-waveform-bottom" width="400", height="80"></canvas>
            <div class="Player-waveform-inner Player-waveform-clip js-waveform-progress">
                <canvas class="js-waveform-top" width="400", height="80"></canvas>
            </div>
        </div>
        <button class="Player-button js-playpause">PLAY</button>
        <input class="Player-volume js-volume" type="range" min="0" max="100" value="100" />
        <div class="Player-info js-output"></div>
    </div>

    <h3>Player B</h3>

    <div class="Player js-playerB">
        <div class="Player-waveform">
            <canvas class="Player-waveform-inner js-waveform-bottom" width="400", height="80"></canvas>
            <div class="Player-waveform-inner Player-waveform-clip js-waveform-progress">
                <canvas class="js-waveform-top" width="400", height="80"></canvas>
            </div>
        </div>
        <button class="Player-button js-playpause">PLAY</button>
        <input class="Player-volume js-volume" type="range" min="0" max="100" value="100" />
        <div class="Player-info js-output"></div>
    </div>

    

    <h3>Master volume</h3>
    <div><input class="js-master-volume" type="range" min="0" max="100" value="100" /><div>

    <script>
        // Test with no WebAudio
        //window.AudioContext = window.webkitAudioContext = undefined;
    </script>
	<script src="../dist/sono.js"></script>
    <script src="../bower_components/usfl/dist/usfl.js"></script>
    <script src="../bower_components/usfl/src/lib/graphics.js"></script>
    <script>
        (function() {
            'use strict';

            function Player(sound, selector) {

                var view = document.querySelector(selector);
                var waveformBottom = view.querySelector('.js-waveform-bottom');
                var waveformTop = view.querySelector('.js-waveform-top');
                var waveformProgress = view.querySelector('.js-waveform-progress');
                var button = view.querySelector('.js-playpause');
                var volumeSlider = view.querySelector('.js-volume');
                var output = view.querySelector('.js-output');

                // update
                function update() {
                    if(sound.playing) {
                        window.requestAnimationFrame(update);
                    }
                    
                    output.innerHTML = sound.currentTime.toFixed(2) + ' / ' +
                                       sound.duration.toFixed(2) + ' / ' +
                                       sound.progress.toFixed(2);

                    waveformProgress.style.width = (sound.progress * 100).toFixed(1) + '%';
                }
                update();

                // button
                button.addEventListener('click', function() {
                    if(sound.playing) {
                        sound.pause();
                        button.innerHTML = 'PLAY';
                    }
                    else {
                        sound.play();
                        button.innerHTML = 'PAUSE';
                        update();
                    }
                });
                sound.onEnded(function() {
                    button.innerHTML = 'PLAY';
                });

                // volume
                var onVolumeChange = function() {
                    sound.volume = this.value / 100;
                };
                volumeSlider.addEventListener('change', onVolumeChange);

                // waveform
                var waveformData = Sono.utils.waveformData(sound._data, waveformBottom.width);
                Sono.utils.waveform(waveformData, waveformBottom.height, '#00ffff', '#333333', waveformBottom);
                Sono.utils.waveform(waveformData, waveformTop.height, '#ffffff', '#333333', waveformTop);
            }


            var soundLoadProgress = function(progress) {
                //console.log('soundLoadProgress', progress);
            };

            // test no WebAudio
            //SONO.context = null;
            var soundA = Sono.load(['audio/VOX.ogg', 'audio/VOX.mp3'], function(sound) {
                new Player(sound, '.js-playerA');
            });
            soundA.loader.onProgress.add(soundLoadProgress, this);
            //this.sound.loop = true;
            //this.sound.addNode(SONO.create.reverb(0.2, 0.5));
            var delay = Sono.create.delay(soundA._gain, 0.5, 0.5);


            var soundB = Sono.load(['audio/TEST.ogg', 'audio/TEST.mp3'], function(sound) {
                new Player(sound, '.js-playerB');
            });
           
            // master gain
            var masterVolumeSlider = document.querySelector('.js-master-volume');
            masterVolumeSlider.addEventListener('change', function() {
                Sono.volume = this.value / 100;
            });

            var sounds = [
                { id: 'a', url: ['audio/TEST.ogg', 'audio/TEST.mp3'] },
                { id: 'b', url: ['audio/VOX.ogg', 'audio/VOX.mp3'] }
            ];

            /*Sono.load(sounds, function(loaded) {
                console.log('all loaded:', loaded)
                console.log(Sono.get(sounds[0].id) === Sono.get('a'), Sono.get('a'));
                console.log(Sono.get(sounds[1].id) === Sono.get('b'), Sono.get('b'));
            }, function(progress) {
                console.log('progress:', progress);
            });*/

        }());
    </script>
</body>
</html>
