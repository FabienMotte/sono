<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, minimal-ui">
    <title>Sono</title>
    <link href="css/styles.css" rel="stylesheet">
</head>
<body>
    <h1>Phaser</h1>

    <h3>Phasing webaudio</h3>
    <div class="js-playerA"></div>

    <div style="padding: 4px;"></div>

    <form class="Player-slider" oninput="output.value=range.value">
        <h4>LFO gain <output name="output" for="range"></output></h4>
        <span>0.0005</span><input class="Player-slider-input js-lfo-gain" name="range" type="range" min="0.0005" max="1000" step="0.00025" value="0.005" /><span>0.010</span>
    </form>

    <form class="Player-slider" oninput="output.value=range.value">
        <h4>LFO frequency <output name="output" for="range"></output></h4>
        <span>0.05</span><input class="Player-slider-input js-lfo-freq" name="range" type="range" min="0.05" max="40" step="0.05" value="0.5" /><span>5</span>
    </form>

    <form class="Player-slider" oninput="output.value=range.value/100">
        <h4>Feedback <output name="output" for="range"></output></h4>
        <span>0</span><input class="Player-slider-input js-feedback" name="range" type="range" min="0" max="90" value="50" /><span>0.9</span>
    </form>

    <button class="Player-button" data-js="TOGGLE">OFF</button>

    <h3>Phasing pre-recorded</h3>
    <div class="js-playerB"></div>

    <script>
        // Test with no WebAudio
        //window.AudioContext = window.webkitAudioContext = undefined;
    </script>
    <script src="../dist/sono.js"></script>
    <script src="js/player.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            'use strict';

            Sono.log();

            var original,
                phaser;
            
            var lfoGain = document.querySelector('.js-lfo-gain');
            lfoGain.addEventListener('change', function() {
                phaser.lfoGain = this.value;
            });

            var lfoFreq = document.querySelector('.js-lfo-freq');
            lfoFreq.addEventListener('change', function() {
                phaser.lfoFrequency = this.value;
            });

            var feedback = document.querySelector('.js-feedback');
            feedback.addEventListener('change', function() {
                phaser.feedback = this.value / 100;
            });

            var btnToggle = document.querySelector('[data-js="TOGGLE"]');
            btnToggle.addEventListener('click', function() {
                if(this.innerHTML === 'OFF') {
                    this.innerHTML = 'ON'
                    original.node.remove(phaser);
                }
                else {
                    this.innerHTML = 'OFF'
                    original.node.add(phaser);
                }
            });

            Sono.load({
                url: [
                    {
                        id: 'original',
                        url: ['audio/Original.ogg', 'audio/Original.mp3']
                    },
                    {
                        id: 'phasing',
                        url: ['audio/Phasing.ogg', 'audio/Phasing.mp3']
                    }
                ],
                onComplete: function(sounds) {

                    original = Sono.getSound('original');
                    phaser = original.node.phaser();

                    new Player(original, document.querySelector('.js-playerA'));
                    new Player(Sono.getSound('phasing'), document.querySelector('.js-playerB'));
                }

            });

        });
    </script>
</body>
</html>
